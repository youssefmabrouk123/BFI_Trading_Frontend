<div class="trade-popup-container">
  <div class="popup-header">
    <div class="header-left">
      <span class="type-badge">FX</span>
      <h2 class="instrument-name">{{ instrument }}</h2>
    </div>
    <button class="close-btn" (click)="close()" [disabled]="isProcessing">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 2L14 14M2 14L14 2" stroke="#E5BF7D" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>

  <div class="price-details">
    <div class="price-box" [ngClass]="{'active': selectedOperation === 'VENDRE'}" (click)="setOperation('VENDRE')">
      <span class="price-label">SELL</span>
      <strong class="price-value">{{ askPrice | number:'1.4-4' }}</strong>
    </div>
    <div class="price-box" [ngClass]="{'active': selectedOperation === 'ACHETER'}" (click)="setOperation('ACHETER')">
      <span class="price-label">BUY</span>
      <strong class="price-value">{{ bidPrice | number:'1.4-4' }}</strong>
    </div>
  </div>

  <div class="spread-info">
    Spread: {{ spread | number:'1.1-1' }} pips
  </div>

  <div class="operation-selector">
    <button class="operation-btn" 
            [ngClass]="{'active': selectedOperation === 'VENDRE'}"
            (click)="setOperation('VENDRE')"
            [disabled]="isProcessing">
      Sell
    </button>
    <button class="operation-btn" 
            [ngClass]="{'active': selectedOperation === 'ACHETER'}"
            (click)="setOperation('ACHETER')"
            [disabled]="isProcessing">
      Buy
    </button>
  </div>

  <div class="quantity-container">
    <div class="quantity-label">Amount ({{ selectedOperation === 'ACHETER' ? baseCurrency : quoteCurrency }})</div>
    <div class="quantity-selector">
      <button class="quantity-btn minus" (click)="decrementQuantity()" [disabled]="isProcessing">
        <svg width="12" height="2" viewBox="0 0 12 2" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1 1H11" stroke="#E5BF7D" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
      <input type="number" 
             class="quantity-input" 
             [(ngModel)]="quantity" 
             min="1" 
             (change)="onQuantityChange($event)"
             [disabled]="isProcessing" />
      <button class="quantity-btn plus" (click)="incrementQuantity()" [disabled]="isProcessing">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 1V11M1 6H11" stroke="#E5BF7D" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="trade-summary">
    <div class="summary-row">
      <span class="summary-label">Price</span>
      <span class="summary-value">
        {{ (selectedOperation === 'ACHETER' ? bidPrice : askPrice) | number:'1.4-4' }}
        {{ quoteCurrency }}
      </span>
    </div>
    <div class="summary-row">
      <span class="summary-label">Total</span>
      <span class="summary-value highlight">
        {{ getTotalAmount() | number:'1.4-4' }}
        {{ quoteCurrency }}
      </span>
    </div>
  </div>

  <button class="confirm-btn" 
          [ngClass]="{'sell': selectedOperation === 'VENDRE', 'buy': selectedOperation === 'ACHETER'}" 
          (click)="confirmTrade()"
          [disabled]="isProcessing">
    <span *ngIf="!isProcessing">{{ selectedOperation }} {{ quantity }} {{ baseCurrency }}</span>
    <span *ngIf="isProcessing" class="loading-spinner"></span>
    <span *ngIf="isProcessing">Processing...</span>
  </button>
</div>