<div class="min-h-screen bg-gray-50">
    <!-- Loading state -->
    <div *ngIf="loading" class="flex justify-center items-center h-screen">
      <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"></div>
    </div>
  
    <!-- Error state -->
    <div *ngIf="error" class="flex justify-center items-center h-screen">
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
        <strong class="font-bold">Erreur !</strong>
        <span class="block sm:inline"> Impossible de charger les données du tableau de bord.</span>
        <button (click)="loadDashboardData()" class="mt-3 bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
          Réessayer
        </button>
      </div>
    </div>
  
    <!-- Dashboard content -->
    <div *ngIf="!loading && !error && stats" class="container mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-6">Tableau de bord</h1>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-gray-600 text-sm font-medium">Nombre de transactions</h3>
          <p class="text-2xl font-bold text-gray-800">{{ stats.transactionCount }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-gray-600 text-sm font-medium">Volume total</h3>
          <p class="text-2xl font-bold text-gray-800">{{ formatCurrency(stats.totalVolume) }} TND</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-gray-600 text-sm font-medium">Profit/Perte total</h3>
          <p class="text-2xl font-bold" [ngClass]="{'text-green-600': stats.totalProfitLoss >= 0, 'text-red-600': stats.totalProfitLoss < 0}">
            {{ formatCurrency(stats.totalProfitLoss) }} TND
          </p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-gray-600 text-sm font-medium">Valeur du portefeuille</h3>
          <p class="text-2xl font-bold text-gray-800">{{ formatCurrency(stats.currentPortfolioValue) }} TND</p>
        </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Profit/Perte par jour</h3>
          <div class="h-80"><canvas id="profitLossChart"></canvas></div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Volume par devise</h3>
          <div class="h-80"><canvas id="volumeChart"></canvas></div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Activité horaire</h3>
          <div class="h-80"><canvas id="hourlyActivityChart"></canvas></div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Tendances des taux de change</h3>
          <div class="h-80"><canvas id="exchangeRateChart"></canvas></div>
        </div>
      </div>
      <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Métriques de performance</h3>
          <div class="space-y-3">
            <div *ngFor="let metric of stats.performanceMetrics" class="flex justify-between">
              <span class="text-gray-600">{{ metric.name }}</span>
              <span class="font-medium" [ngClass]="{'text-green-600': metric.value >= 0, 'text-red-600': metric.value < 0}">
                {{ formatCurrency(metric.value) }}{{ metric.name.includes('Taux') ? '%' : ' TND' }}
              </span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Taux de succès</span>
              <span class="font-medium text-green-600">{{ formatCurrency(stats.successRate) }}%</span>
            </div>
          </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Transactions récentes</h3>
          <div class="space-y-3 max-h-60 overflow-y-auto">
            <div *ngFor="let tx of stats.recentTransactions" class="flex justify-between text-sm border-b pb-2">
              <span class="text-gray-600">{{ tx.actionType }}</span>
              <span class="text-gray-800">{{ tx.details }}</span>
              <span class="text-gray-500">{{ formatDate(tx.actionTime) }}</span>
            </div>
            <p *ngIf="!stats.recentTransactions.length" class="text-gray-500">Aucune transaction récente</p>
          </div>
        </div>
      </div>
      <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Dernière action</h3>
        <p class="text-gray-600">{{ formatDate(stats.lastAction) || 'Aucune action enregistrée' }}</p>
      </div>
    </div>
  </div>